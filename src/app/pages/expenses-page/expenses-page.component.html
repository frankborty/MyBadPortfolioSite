<div class="grid grid-cols-12 gap-4">
  <div class="flex col-span-12 mt-3 mb-3 gap-3 rounded-lg">
    <p-floatlabel variant="on">
      <p-datepicker [(ngModel)]="selectedYear" (ngModelChange)="filterExpenses()" view="year" dateFormat="yy" [showButtonBar]="true" ngModel showIcon iconDisplay="input"/>
      <label for="YearLabel">Year</label>
    </p-floatlabel>
    
    <p-floatlabel variant="on">
      <p-datepicker 
       [(ngModel)]="selectedMonth"  (ngModelChange)="filterExpenses()" view="month" dateFormat="mm/yy" [showButtonBar]="true" showIcon  iconDisplay="input"/>
      <label for="MonthLabel">Month</label>
    </p-floatlabel>
  </div>

  <div class="col-span-12 border-2 rounded-lg">
    <p-contextmenu #cm [model]="contextMenuItems" />
    <p-table 
      [(contextMenuSelection)]="selectedExpense" 
      [contextMenu]="cm"
      [(selection)]="selectedExpenseList"
      selectionMode="multiple"
      dataKey="id"
      [scrollable]="true"
      [value]="expenseList"  
      [resizableColumns]="true"
      [size]="'small'" 
      showGridlines 
      stripedRows 
      [paginator]="true"
      [rows]="30"
      [rowsPerPageOptions]="[10, 30, 50, 100]"
      >
      <ng-template pTemplate="header">
        <tr>
          <th pResizableColumn pSortableColumn="description" class="text-left w-80">Description
            <p-columnFilter type="text" field="description" display="menu" />
          </th>
          <th pResizableColumn pSortableColumn="amount" class="text-right w-20">Cost â‚¬
            <p-columnFilter type="numeric" field="amount" display="menu" currency="EUR" />
          </th>
          <th pResizableColumn pSortableColumn="expenseType.name" class="text-right w-40">Type
            <p-columnFilter field="expenseType.name" matchMode="in" display="menu" [showMatchModes]="false" [showOperator]="false" [showAddButton]="false" class="ml-auto">
              <ng-template #filter let-value let-filter="filterCallback">
                <p-multiselect 
                  [filter]="true" 
                  [ngModel]="value" 
                  [options]="expenseTypesString" 
                  placeholder="Any" 
                  (onChange)="filter($event.value)" 
                  class="w-full">
                  <ng-template let-type #item>
                    <div class="flex items-center gap-2">
                      <span>{{ type }}</span>
                    </div>
                  </ng-template>
                </p-multiselect>
              </ng-template>
            </p-columnFilter>
          </th>
          <th pResizableColumn pSortableColumn="expenseType.category.name   " class="text-right w-40">Category
            <p-columnFilter field="expenseType.category.name" matchMode="in" display="menu" [showMatchModes]="false" [showOperator]="false" [showAddButton]="false" class="ml-auto">
              <ng-template #filter let-value let-filter="filterCallback">
                <p-multiselect 
                  [filter]="true" 
                  [ngModel]="value" 
                  [options]="expenseCategoriesString" 
                  placeholder="Any" 
                  (onChange)="filter($event.value)" 
                  class="w-full">
                  <ng-template let-category #item>
                    <div class="flex items-center gap-2">
                      <span>{{ category }}</span>
                    </div>
                  </ng-template>
                </p-multiselect>
              </ng-template>
            </p-columnFilter>
          </th>
          <th pResizableColumn pSortableColumn="date" class="text-right w-32">Date
            <p-columnFilter type="date" field="date" display="menu">
              <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                  <p-calendar  [ngModel]="value" (onSelect)="filter($event)" dateFormat="dd/mm/yy"></p-calendar>
              </ng-template>
            </p-columnFilter>
          </th>
          <th pResizableColumn pSortableColumn="note">Note</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-expense let-rowIndex="rowIndex">
        <tr [pContextMenuRow]="expense"[pSelectableRow]="expense" [pSelectableRowIndex]="rowIndex">
          <td>{{ expense.description }}</td>
          <td class="text-right">{{ expense.amount  | number:'1.1-1' }}</td>
          <td class="text-right">{{ expense.expenseType.name }}</td>
          <td class="text-right">{{ expense.expenseType.category.name }}</td>
          <td class="text-right">{{ expense.date | date: 'dd/MM/yyyy'}}</td>
          <td>{{ expense.note }}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6">No expenses found.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <div class="grow col-span-12 flex flex-wrap gap-4 justify-center">
    <div class="w-96 bg-red-600 h-40 mb-4"></div>
    <div class="w-96 bg-yellow-300 h-40 mb-4"></div>
    <div class="w-96 bg-blue-700 h-40 mb-4"></div>
  </div>


  <p-dialog header="Add Expense" [styleClass]="'w-[60vh] h-[80vh]'" [(visible)]="displayAddExpenseDialog" [modal]="true" [closable]="true">
    <app-add-expense (addNewExpenseCallBack)="addNewExpense($event)"></app-add-expense>
  </p-dialog>

  
  <p-dialog header="Edit Expense" [styleClass]="'w-[60vh] h-[80vh]'" [(visible)]="displayEditExpenseDialog" [modal]="true" [closable]="true">
    <app-edit-expense (editNewExpenseCallBack)="editNewExpense($event)"></app-edit-expense>
  </p-dialog>
</div>

  
<p-toast />
<app-param-confirmation-dialog></app-param-confirmation-dialog>

<div class="add-container">
  <p-button 
    styleClass="action-button" 
    severity="success" 
    icon="pi pi-plus" 
    [rounded]="true" 
    (click)="showAddExpenseDialog()">
  </p-button>
</div> 

<div class="del-container " *ngIf="selectedExpenseList.length > 0">
  <p-button  
    styleClass="action-button del-button" 
    severity="danger" 
    icon="pi pi-trash"
    (click)="deleteExpenseList()">
  </p-button>
</div>